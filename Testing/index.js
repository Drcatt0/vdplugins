(function(f,L,g,t,B,C,c,d,F,D,G,k,O,E){"use strict";const H="https://saucenao.com";const settings={target_source:"SauceNAO"};const sources={saucenao:"SauceNAO",google:"Google Reverse Image",yandex:"Yandex Reverse Image"};const sourceChoices=Object.entries(sources).map(([k,v])=>({name:v,displayName:v,value:k}));const settingsMenu=()=>{const{useProxy}=O;useProxy(settings);const[search,setSearch]=t.React.useState("");return t.React.createElement(d.ScrollView,{style:{flex:1}},t.React.createElement(d.Search,{style:{padding:15},placeholder:"Search Source",onChangeText:setSearch}),sourceChoices.filter(i=>i.name.toLowerCase().includes(search.toLowerCase())).map(({name,value})=>t.React.createElement(d.FormRow,{label:name,trailing:t.React.createElement(d.FormRow.Arrow,null),onPress:()=>{settings.target_source=value;E.showToast(`Source set to ${name}`,c.getAssetIDByName("check"))}})))};var w={search:async function(e){try{const url=`${H}/search.php?url=${encodeURIComponent(e)}`;t.url.openURL(url)}catch(n){E.showToast("Error opening link.",c.getAssetIDByName("Small"))}}};const M=g.findByProps("openLazy","hideActionSheet"),P=((y=g.findByProps("ActionSheetRow"))===null||y===void 0?void 0:y.ActionSheetRow)??d.Forms.FormRow,j=g.findByStoreName("MessageStore"),V=g.findByStoreName("ChannelStore"),z=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:C.semanticColors.INTERACTIVE_NORMAL}});let T=[];function K(){return B.before("openLazy",M,function(e){let[a,i,s]=e;const n=s?.message;i!=="MessageLongPressActionSheet"||!n||a.then(function(A){const ae=B.after("default",A,function(ue,ie){t.React.useEffect(function(){return function(){ae()}},[]);const v=F.findInReactTree(ie,function(r){var l,h;return(r==null||(h=r[0])===null||h===void 0||(l=h.type)===null||l===void 0?void 0:l.name)==="ButtonRow"});if(!v)return;const re=Math.max(v.findIndex(function(r){return r.props.message===t.i18n.Messages.MARK_UNREAD}),0),u=j.getMessage(n.channel_id,n.id);const imageAttachments = u?.attachments?.filter(att => att.content_type?.startsWith("image")); if (!imageAttachments || imageAttachments.length === 0) return; const S=u?.id??n.id,se=u?.content??n.content,I=T.find(function(r){return Object.keys(r)[0]===S},"cache object"),_="Search Image",icon=c.getAssetIDByName("ic_search"),oe=function(){if(imageAttachments.length === 1){const searchUrl=`${H}/search.php?url=${encodeURIComponent(imageAttachments[0].url)}`;t.url.openURL(searchUrl);}else{const links = imageAttachments.map((att, index) => `> [Image ${index + 1}](${H}/search.php?url=${encodeURIComponent(att.url)})`).join("\n");t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...u,content:links,guild_id:V.getChannel(u.channel_id).guild_id},log_edit:!1});}M.hideActionSheet();};v.splice(re,0,t.React.createElement(P,{label:_,icon:t.React.createElement(P.Icon,{source:icon,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:z.iconComponent,source:icon})}}),onPress:oe}))})})})}let b=[];var ne={onLoad:function(){return b=[K()]},onUnload:function(){for(const e of b)e()},settings:settingsMenu};return f.default=ne,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
