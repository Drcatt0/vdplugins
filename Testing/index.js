(function(f,L,g,t,B,C,c,d,F,D,G,k,O,E){"use strict";const sources={saucenao:"https://saucenao.com/search.php?url={url}",google:"https://www.google.com/searchbyimage?image_url={url}",tineye:"https://tineye.com/search?url={url}",yandex:"https://yandex.com/images/search?rpt=imageview&url={url}"};const sourceChoices=Object.entries(sources).map(([key,value])=>({name:key.charAt(0).toUpperCase()+key.slice(1),displayName:key.charAt(0).toUpperCase()+key.slice(1),value:key}));f.storage.selectedSource??="saucenao";function SettingsPage(){const navigation=t.NavigationNative.useNavigation();return t.React.createElement(d.ScrollView,null,t.React.createElement(d.FormRow,{label:"Image Search Source",subLabel:f.storage.selectedSource,leading:t.React.createElement(d.FormRow.Icon,{source:c.getAssetIDByName("ic_activity_24px")}),trailing:function(){return t.React.createElement(d.FormRow.Arrow,null)},onPress:function(){navigation.push("VendettaCustomPage",{title:"Image Search Source",render:SourceSelection})}}))}function SourceSelection(){const[selected,setSelected]=t.React.useState(f.storage.selectedSource);return t.React.createElement(d.ScrollView,{style:{flex:1}},sourceChoices.map(choice=>t.React.createElement(d.FormRow,{label:choice.displayName,trailing:function(){return t.React.createElement(d.RadioButton,{selected:selected===choice.value,onPress:function(){setSelected(choice.value),f.storage.selectedSource=choice.value,d.showToast(`Saved Source to ${choice.displayName}`,c.getAssetIDByName("check"))}})}})))}const M=g.findByProps("openLazy","hideActionSheet"),P=g.findByProps("ActionSheetRow")??d.Forms.FormRow,j=g.findByStoreName("MessageStore"),V=g.findByStoreName("ChannelStore"),z=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:C.semanticColors.INTERACTIVE_NORMAL}});let T=[];function K(){return B.before("openLazy",M,function(e){let[a,i,s]=e;const n=s?.message;i!=="MessageLongPressActionSheet"||!n||a.then(function(A){const ae=B.after("default",A,function(ue,ie){t.React.useEffect(function(){return function(){ae()}},[]);const v=F.findInReactTree(ie,function(r){var l,h;return(r==null||(h=r[0])===null||h===void 0||(l=h.type)===null||l===void 0?void 0:l.name)==="ButtonRow"});if(!v)return;const re=Math.max(v.findIndex(function(r){return r.props.message===t.i18n.Messages.MARK_UNREAD}),0),u=j.getMessage(n.channel_id,n.id);const imageAttachments=u?.attachments?.filter(att=>att.content_type?.startsWith("image"));if(!imageAttachments||imageAttachments.length===0)return;const searchUrl=sources[f.storage.selectedSource].replace("{url}",encodeURIComponent(imageAttachments[0].url));const S="Search Image",icon=c.getAssetIDByName("ic_search");v.splice(re,0,t.React.createElement(P,{label:S,icon:t.React.createElement(P.Icon,{source:icon,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:z.iconComponent,source:icon})}}),onPress:function(){t.url.openURL(searchUrl),M.hideActionSheet()}}))})})})}let b=[];var ne={onLoad:function(){return b=[K()]},onUnload:function(){for(const e of b)e()},settings:SettingsPage};return f.default=ne,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.metro,vendetta.ui,vendetta.patcher,vendetta.storage,vendetta.ui.components,vendetta.ui.toasts);
