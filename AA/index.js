(function(f,$,s,e,h){"use strict";const Patcher=e.patcher.create("MarkAllAsRead"),{findByProps:A,findByStoreName:C}=s,ReadIcon=e.assets.getAssetIDByName("ic_rulebook_16px"),Toasts=e.ui.toasts,React=e.React,{View}=s.findByProps("View"),getSetting=(key,defaultValue)=>f.storage[key]??defaultValue,bulkMarkAllAsRead=()=>{let toRead=[];const AllReadStates=C("ReadStateStore").getAllReadStates().map(m=>({...m})),OnlyUnreadOrMentions=AllReadStates.filter(m=>C("ReadStateStore").hasUnread(m.channelId));if(getSetting("dm",true)){const UnreadDMs=OnlyUnreadOrMentions.filter(m=>C("ChannelStore").getChannel(m.channelId)?.isDM());const DMsToRead=UnreadDMs.map(m=>({channelId:m.channelId,messageId:m._lastMessageId}));toRead.push(...DMsToRead)}if(getSetting("server",true)){const UnreadGuildChannels=OnlyUnreadOrMentions.filter(m=>Boolean(C("ChannelStore").getChannel(m.channelId)?.getGuildId()));const GuildChannelsToRead=UnreadGuildChannels.map(m=>({channelId:m.channelId,messageId:m._lastMessageId}));toRead.push(...GuildChannelsToRead)}A("AckUtils").bulkAck(toRead);Toasts.open({content:`Marked all messages as read`,source:e.assets.getAssetIDByName("ic_check_24px")})};var plugin={onLoad(){Patcher.after(View,"render",(_,args,res)=>{const GuildPopoutMenu=h.findInReactTree(res,r=>r.props?.guildId&&r.props?.yPos&&r.props?.onClose);if(GuildPopoutMenu){Patcher.after(GuildPopoutMenu.type,"render",(_,args,res)=>{res.props.rows.unshift({icon:ReadIcon,text:"Mark All As Read",onClick:bulkMarkAllAsRead})})}})},onUnload(){Patcher.unpatchAll()}};return f.default=plugin,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.utilities);
